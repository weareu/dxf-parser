!function(e,a){"object"==typeof exports&&"object"==typeof module?module.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?exports.DxfParser=a():e.DxfParser=a()}("undefined"!=typeof self?self:this,()=>(()=>{var e={65:function(e,a,t){var n,r;!function(){"use strict";n=function(){var e=function(){},a="undefined",t=typeof window!==a&&typeof window.navigator!==a&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,a){var t=e[a];if("function"==typeof t.bind)return t.bind(e);try{return Function.prototype.bind.call(t,e)}catch(a){return function(){return Function.prototype.apply.apply(t,[e,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(a,t){for(var r=0;r<n.length;r++){var o=n[r];this[o]=r<a?e:this.methodFactory(o,a,t)}this.log=this.debug}function c(e,t,n){return function(){typeof console!==a&&(s.call(this,t,n),this[e].apply(this,arguments))}}function l(n,s,l){return function(n){return"debug"===n&&(n="log"),typeof console!==a&&("trace"===n&&t?o:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||c.apply(this,arguments)}function i(e,t,r){var o,c=this,i="loglevel";function u(){var e;if(typeof window!==a&&i){try{e=window.localStorage[i]}catch(e){}if(typeof e===a)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(i)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(e){}return void 0===c.levels[e]&&(e=void 0),e}}"string"==typeof e?i+=":"+e:"symbol"==typeof e&&(i=void 0),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=r||l,c.getLevel=function(){return o},c.setLevel=function(t,r){if("string"==typeof t&&void 0!==c.levels[t.toUpperCase()]&&(t=c.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(o=t,!1!==r&&function(e){var t=(n[e]||"silent").toUpperCase();if(typeof window!==a&&i){try{return void(window.localStorage[i]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(i)+"="+t+";"}catch(e){}}}(t),s.call(c,t,e),typeof console===a&&t<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){u()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var d=u();null==d&&(d=null==t?"WARN":t),c.setLevel(d,!1)}var u=new i,d={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var a=d[e];return a||(a=d[e]=new i(e,u.getLevel(),u.methodFactory)),a};var b=typeof window!==a?window.log:void 0;return u.noConflict=function(){return typeof window!==a&&window.log===u&&(window.log=b),u},u.getLoggers=function(){return d},u.default=u,u},void 0===(r=n.call(a,t,a,e))||(e.exports=r)}()}},a={};function t(n){var r=a[n];if(void 0!==r)return r.exports;var o=a[n]={exports:{}};return e[n].call(o.exports,o,o.exports,t),o.exports}t.d=(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a);var n={};return(()=>{"use strict";t.d(n,{DxfParser:()=>C});class e{_pointer=0;_eof=!1;lastReadGroup;_data;constructor(e){this._data=e}next(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);const e={code:parseInt(this._data[this._pointer])};return this._pointer++,e.value=a(e.code,this._data[this._pointer].trim()),this._pointer++,0===e.code&&"EOF"===e.value&&(this._eof=!0),this.lastReadGroup=e,e}peek(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);const e={code:parseInt(this._data[this._pointer])};return e.value=a(e.code,this._data[this._pointer+1].trim()),e}rewind(e=1){this._pointer=this._pointer-2*e}hasNext(){return!(this._eof||this._pointer>this._data.length-2)}isEOF(){return this._eof}}function a(e,a){return e<=9?a:e>=10&&e<=59?parseFloat(a):e>=60&&e<=99?parseInt(a):e>=100&&e<=109?a:e>=110&&e<=149?parseFloat(a):e>=160&&e<=179?parseInt(a):e>=210&&e<=239?parseFloat(a):e>=270&&e<=289?parseInt(a):e>=290&&e<=299?function(e){if("0"===e)return!1;if("1"===e)return!0;throw TypeError("String '"+e+"' cannot be cast to Boolean type")}(a):e>=300&&e<=369?a:e>=370&&e<=389?parseInt(a):e>=390&&e<=399?a:e>=400&&e<=409?parseInt(a):e>=410&&e<=419?a:e>=420&&e<=429?parseInt(a):e>=430&&e<=439?a:e>=440&&e<=459?parseInt(a):e>=460&&e<=469?parseFloat(a):e>=470&&e<=481||999===e||e>=1e3&&e<=1009?a:e>=1010&&e<=1059?parseFloat(a):e>=1060&&e<=1071?parseInt(a):(console.log("WARNING: Group code does not have a defined type: %j",{code:e,value:a}),a)}const r=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];function o(e){const a={};e.rewind();let t=e.next(),n=t.code;if(a.x=t.value,n+=10,t=e.next(),t.code!=n)throw new Error("Expected code for point value to be "+n+" but got "+t.code+".");return a.y=t.value,n+=10,t=e.next(),t.code!=n?(e.rewind(),a):(a.z=t.value,a)}function s(e,a){e.rewind();const t=[];for(let n=0;n<16;n++){const n=e.next();if(n.code!==a)throw new Error("Expected code for matrix value to be "+a+" but got "+n.code+".");t.push(n.value)}return t}function c(e,a,t){switch(a.code){case 0:e.type=a.value;break;case 5:e.handle=a.value;break;case 6:e.lineType=a.value;break;case 8:e.layer=a.value;break;case 48:e.lineTypeScale=a.value;break;case 60:e.visible=0===a.value;break;case 62:e.colorIndex=a.value,e.color=(n=Math.abs(a.value),r[n]);break;case 67:e.inPaperSpace=0!==a.value;break;case 100:break;case 101:for(;0!=a.code;)a=t.next();t.rewind();break;case 330:e.ownerHandle=a.value;break;case 347:e.materialObjectHandle=a.value;break;case 370:e.lineweight=a.value;break;case 420:e.color=a.value;break;case 1e3:e.extendedData=e.extendedData||{},e.extendedData.customStrings=e.extendedData.customStrings||[],e.extendedData.customStrings.push(a.value);break;case 1001:e.extendedData=e.extendedData||{},e.extendedData.applicationName=a.value;break;default:return!1}var n;return!0}class l{ForEntityName="3DFACE";parseEntity(e,a){const t={type:a.value,vertices:[],shape:!1,hasContinuousLinetypePattern:!1,layer:"",colorIndex:0,lineType:"",lineTypeScale:1,visible:!0,handle:0,color:0,inPaperSpace:!1,ownerHandle:"",materialObjectHandle:0,lineweight:-3,extendedData:{customStrings:[],applicationName:""}};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 70:t.shape=!(1&~a.value),t.hasContinuousLinetypePattern=!(128&~a.value);break;case 10:t.vertices=i(e,a),a=e.lastReadGroup;break;default:c(t,a,e)}a=e.next()}return t}}function i(e,a){const t=[];let n=!1,r=!1;for(let o=0;o<4;o++){const o={x:0,y:0,z:0};for(;!e.isEOF()&&0!==a.code&&!r;){switch(a.code){case 10:case 11:case 12:case 13:if(n){r=!0;continue}o.x=a.value,n=!0;break;case 20:case 21:case 22:case 23:o.y=a.value;break;case 30:case 31:case 32:case 33:o.z=a.value;break;default:return n&&t.push(o),e.rewind(),t}a=e.next()}n&&t.push(o),n=!1,r=!1}return e.rewind(),t}class u{ForEntityName="ARC";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.center=o(e);break;case 40:t.radius=a.value;break;case 50:t.startAngle=Math.PI/180*a.value;break;case 51:t.endAngle=Math.PI/180*a.value,t.angleLength=t.endAngle-t.startAngle;break;case 210:t.extrusionDirectionX=a.value;break;case 220:t.extrusionDirectionY=a.value;break;case 230:t.extrusionDirectionZ=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class d{ForEntityName="ATTDEF";parseEntity(e,a){var t={type:a.value,scale:1,textStyle:"STANDARD"};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 1:t.text=a.value;break;case 2:t.tag=a.value;break;case 3:t.prompt=a.value;break;case 7:t.textStyle=a.value;break;case 10:t.startPoint=o(e);break;case 11:t.endPoint=o(e);break;case 39:t.thickness=a.value;break;case 40:t.textHeight=a.value;break;case 41:t.scale=a.value;break;case 50:t.rotation=a.value;break;case 51:t.obliqueAngle=a.value;break;case 70:t.invisible=!!(1&a.value),t.constant=!!(2&a.value),t.verificationRequired=!!(4&a.value),t.preset=!!(8&a.value);break;case 71:t.backwards=!!(2&a.value),t.mirrored=!!(4&a.value);break;case 72:t.horizontalJustification=a.value;break;case 73:t.fieldLength=a.value;break;case 74:t.verticalJustification=a.value;break;case 100:break;case 210:t.extrusionDirectionX=a.value;break;case 220:t.extrusionDirectionY=a.value;break;case 230:t.extrusionDirectionZ=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class b{ForEntityName="CIRCLE";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.center=o(e);break;case 40:t.radius=a.value;break;case 50:t.startAngle=Math.PI/180*a.value;break;case 51:const n=Math.PI/180*a.value;n<t.startAngle?t.angleLength=n+2*Math.PI-t.startAngle:t.angleLength=n-t.startAngle,t.endAngle=n;break;default:c(t,a,e)}a=e.next()}return t}}class v{ForEntityName="DIMENSION";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 2:t.block=a.value;break;case 10:t.anchorPoint=o(e);break;case 11:t.middleOfText=o(e);break;case 12:t.insertionPoint=o(e);break;case 13:t.linearOrAngularPoint1=o(e);break;case 14:t.linearOrAngularPoint2=o(e);break;case 15:t.diameterOrRadiusPoint=o(e);break;case 16:t.arcPoint=o(e);break;case 70:t.dimensionType=a.value;break;case 71:t.attachmentPoint=a.value;break;case 42:t.actualMeasurement=a.value;break;case 1:t.text=a.value;break;case 50:t.angle=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class k{ForEntityName="MULTILEADER";parseEntity(e,a){const t={type:a.value};function n(){for(;!e.isEOF();){switch(a.code){case 40:t.contextData.contentScale=a.value;break;case 10:t.contextData.contentBasePosition=o(e);break;case 145:t.contextData.landingGap=a.value;break;case 290:t.contextData.hasMText=a.value;break;case 304:t.contextData.defaultTextContents=a.value;break;case 11:t.contextData.textNormalDirection=o(e);break;case 12:t.contextData.textLocation=o(e);break;case 13:t.contextData.textDirection=o(e);break;case 140:t.contextData.arrowHeadSize=a.value;break;case 41:case 44:t.contextData.textHeight=a.value;break;case 42:t.contextData.textRotation=a.value;break;case 43:t.contextData.textWidth=a.value;break;case 45:t.contextData.textLineSpacingFactor=a.value;break;case 90:t.contextData.textColor=a.value;break;case 170:t.contextData.textLineSpacingStyle=a.value;break;case 171:t.contextData.textAttachment=a.value;break;case 172:t.contextData.textFlowDirection=a.value;break;case 141:t.contextData.textBackgroundScaleFactor=a.value;break;case 92:t.contextData.textBackgroundTransparency=a.value;break;case 291:t.contextData.textBackgroundColorOn=a.value;break;case 292:t.contextData.textBackgroundFillOn=a.value;break;case 293:t.contextData.textUseAutoHeight=a.value;break;case 173:t.contextData.textColumnType=a.value;break;case 142:t.contextData.textColumnWidth=a.value;break;case 143:t.contextData.textColumnGutterWidth=a.value;break;case 144:t.contextData.textColumnHeight=a.value;break;case 295:t.contextData.textUseWordBreak=a.value;break;case 296:t.contextData.hasBlock=a.value;break;case 341:t.contextData.blockContentId=a.value;break;case 14:t.contextData.blockContentNormalDirection=o(e);break;case 15:t.contextData.blockContentPosition=o(e);break;case 16:t.contextData.blockContentScale=a.value;break;case 46:t.contextData.blockContentRotation=a.value;break;case 93:t.contextData.blockContentColor=a.value;break;case 47:t.contextData.blockTransformationMatrix=s(e,47);break;case 110:t.contextData.planeOriginPoint=o(e);break;case 111:t.contextData.planeXAxisDirection=o(e);break;case 112:t.contextData.planeYAxisDirection=o(e);break;case 297:t.contextData.planeNormalReversed=a.value;break;case 301:return;case 302:r()}a=e.next()}}function r(){const n={leaderLines:[]};for(t.contextData.leaders.push(n);!e.isEOF();){switch(a.code){case 290:n.hasSetLastLeaderLinePoint=a.value;break;case 291:n.hasSetDoglegVector=a.value;break;case 10:n.lastLeaderLinePoint=o(e);break;case 11:n.doglegVector=o(e);break;case 90:n.leaderBranchIndex=a.value;break;case 40:n.doglegLength=a.value;break;case 303:return;case 304:l()}a=e.next()}}function l(){const n={vertices:[[]]};for(t.contextData.leaders[t.contextData.leaders.length-1].leaderLines.push(n);!e.isEOF();){switch(a.code){case 10:n.vertices[0].push(o(e));break;case 305:return}a=e.next()}}return t.contextData={leaders:[]},a=e.next(),function(){for(;!e.isEOF();){switch(a.code){case 0:return;case 340:t.leaderStyleId=a.value;break;case 170:t.leaderLineType=a.value;break;case 91:t.leaderLineColor=a.value;break;case 341:t.leaderLineTypeId=a.value;break;case 171:t.leaderLineWeight=a.value;break;case 41:t.doglegLength=a.value;break;case 290:t.enableLanding=a.value;break;case 291:t.enableDogLeg=a.value;break;case 342:t.arrowHeadId=a.value;break;case 42:t.arrowHeadSize=a.value;break;case 172:t.contentType=a.value;break;case 173:case 95:t.textLeftAttachmentType=a.value;break;case 174:t.textAngleType=a.value;break;case 175:t.textAlignmentType=a.value;break;case 343:t.textStyleId=a.value;break;case 92:t.textColor=a.value;break;case 292:t.enableFrameText=a.value;break;case 344:t.blockContentId=a.value;break;case 93:t.blockContentColor=a.value;break;case 10:t.blockContentScale=o(e);break;case 43:t.blockContentRotation=a.value;break;case 176:t.blockContentConnectionType=a.value;break;case 293:t.enableAnotationScale=a.value;break;case 94:t.arrowHeadIndex=a.value;break;case 330:t.blockAttributeId=a.value;break;case 177:t.blockAttributeIndex=a.value;break;case 44:t.blockAttributeWidth=a.value;break;case 302:t.blockAttributeTextString=a.value;break;case 294:t.textDirectionNegative=a.value;break;case 178:t.textAlignInIPE=a.value;break;case 179:t.textAttachmentPoint=a.value;break;case 271:t.textAttachmentDirectionMText=a.value;break;case 272:t.textAttachmentDirectionBottom=a.value;break;case 273:t.textAttachmentDirectionTop=a.value;break;case 300:n();break;default:c(t,a,e)}a=e.next()}}(),t}}class x{ForEntityName="ELLIPSE";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.center=o(e);break;case 11:t.majorAxisEndPoint=o(e);break;case 40:t.axisRatio=a.value;break;case 41:t.startAngle=a.value;break;case 42:t.endAngle=a.value;break;case 2:t.name=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class p{ForEntityName="INSERT";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 2:t.name=a.value;break;case 41:t.xScale=a.value;break;case 42:t.yScale=a.value;break;case 43:t.zScale=a.value;break;case 10:t.position=o(e);break;case 50:t.rotation=a.value;break;case 70:t.columnCount=a.value;break;case 71:t.rowCount=a.value;break;case 44:t.columnSpacing=a.value;break;case 45:t.rowSpacing=a.value;break;case 210:t.extrusionDirection=o(e);break;default:c(t,a,e)}a=e.next()}return t}}class f{ForEntityName="LINE";parseEntity(e,a){const t={type:a.value,vertices:[]};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.vertices.unshift(o(e));break;case 11:t.vertices.push(o(e));break;case 210:t.extrusionDirection=o(e);break;case 100:break;default:c(t,a,e)}a=e.next()}return t}}class h{ForEntityName="LWPOLYLINE";parseEntity(e,a){const t={type:a.value,vertices:[]};let n=0;for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 38:t.elevation=a.value;break;case 39:t.depth=a.value;break;case 70:t.shape=!(1&~a.value),t.hasContinuousLinetypePattern=!(128&~a.value);break;case 90:n=a.value;break;case 10:t.vertices=y(n,e);break;case 43:0!==a.value&&(t.width=a.value);break;case 210:t.extrusionDirectionX=a.value;break;case 220:t.extrusionDirectionY=a.value;break;case 230:t.extrusionDirectionZ=a.value;break;default:c(t,a,e)}a=e.next()}return t}}function y(e,a){if(!e||e<=0)throw Error("n must be greater than 0 verticies");const t=[];let n=!1,r=!1,o=a.lastReadGroup;for(let s=0;s<e;s++){const e={};for(;!a.isEOF()&&0!==o.code&&!r;){switch(o.code){case 10:if(n){r=!0;continue}e.x=o.value,n=!0;break;case 20:e.y=o.value;break;case 30:e.z=o.value;break;case 40:e.startWidth=o.value;break;case 41:e.endWidth=o.value;break;case 42:0!=o.value&&(e.bulge=o.value);break;default:return a.rewind(),n&&t.push(e),a.rewind(),t}o=a.next()}t.push(e),n=!1,r=!1}return a.rewind(),t}class g{ForEntityName="MTEXT";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 3:case 1:t.text?t.text+=a.value:t.text=a.value;break;case 10:t.position=o(e);break;case 11:t.directionVector=o(e);break;case 40:t.height=a.value;break;case 41:t.width=a.value;break;case 50:t.rotation=a.value;break;case 71:t.attachmentPoint=a.value;break;case 72:t.drawingDirection=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class E{ForEntityName="POINT";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.position=o(e);break;case 39:t.thickness=a.value;break;case 210:t.extrusionDirection=o(e);break;case 100:break;default:c(t,a,e)}a=e.next()}return t}}class w{ForEntityName="VERTEX";parseEntity(e,a){var t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.x=a.value;break;case 20:t.y=a.value;break;case 30:t.z=a.value;break;case 40:case 41:case 50:break;case 42:0!=a.value&&(t.bulge=a.value);break;case 70:t.curveFittingVertex=!!(1&a.value),t.curveFitTangent=!!(2&a.value),t.splineVertex=!!(8&a.value),t.splineControlPoint=!!(16&a.value),t.threeDPolylineVertex=!!(32&a.value),t.threeDPolylineMesh=!!(64&a.value),t.polyfaceMeshVertex=!!(128&a.value);break;case 71:t.faceA=a.value;break;case 72:t.faceB=a.value;break;case 73:t.faceC=a.value;break;case 74:t.faceD=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class m{ForEntityName="POLYLINE";parseEntity(e,a){var t={type:a.value,vertices:[]};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:case 20:case 30:case 40:case 41:case 71:case 72:case 73:case 74:case 75:break;case 39:t.thickness=a.value;break;case 70:t.shape=!!(1&a.value),t.includesCurveFitVertices=!!(2&a.value),t.includesSplineFitVertices=!!(4&a.value),t.is3dPolyline=!!(8&a.value),t.is3dPolygonMesh=!!(16&a.value),t.is3dPolygonMeshClosed=!!(32&a.value),t.isPolyfaceMesh=!!(64&a.value),t.hasContinuousLinetypePattern=!!(128&a.value);break;case 210:t.extrusionDirection=o(e);break;default:c(t,a,e)}a=e.next()}return t.vertices=function(e,a){const t=new w,n=[];for(;!e.isEOF();)if(0===a.code)if("VERTEX"===a.value)n.push(t.parseEntity(e,a)),a=e.lastReadGroup;else if("SEQEND"===a.value){D(e,a);break}return n}(e,a),t}}function D(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!=a.code;)c(t,a,e),a=e.next();return t}class F{ForEntityName="SOLID";parseEntity(e,a){const t={type:a.value,points:[]};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.points[0]=o(e);break;case 11:t.points[1]=o(e);break;case 12:t.points[2]=o(e);break;case 13:t.points[3]=o(e);break;case 210:t.extrusionDirection=o(e);break;default:c(t,a,e)}a=e.next()}return t}}class S{ForEntityName="SPLINE";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.controlPoints||(t.controlPoints=[]),t.controlPoints.push(o(e));break;case 11:t.fitPoints||(t.fitPoints=[]),t.fitPoints.push(o(e));break;case 12:t.startTangent=o(e);break;case 13:t.endTangent=o(e);break;case 40:t.knotValues||(t.knotValues=[]),t.knotValues.push(a.value);break;case 70:1&a.value&&(t.closed=!0),2&a.value&&(t.periodic=!0),4&a.value&&(t.rational=!0),8&a.value&&(t.planar=!0),16&a.value&&(t.planar=!0,t.linear=!0);break;case 71:t.degreeOfSplineCurve=a.value;break;case 72:t.numberOfKnots=a.value;break;case 73:t.numberOfControlPoints=a.value;break;case 74:t.numberOfFitPoints=a.value;break;case 210:t.normalVector=o(e);break;default:c(t,a,e)}a=e.next()}return t}}class T{ForEntityName="TEXT";parseEntity(e,a){const t={type:a.value};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 10:t.startPoint=o(e);break;case 11:t.endPoint=o(e);break;case 40:t.textHeight=a.value;break;case 41:t.xScale=a.value;break;case 50:t.rotation=a.value;break;case 1:t.text=a.value;break;case 72:t.halign=a.value;break;case 73:t.valign=a.value;break;default:c(t,a,e)}a=e.next()}return t}}class P{ForEntityName="HATCH";parseEntity(e,a){const t={type:a.value,boundaries:[],solidFill:!1,associativity:!1,boundaryPathsCount:0,annotatedBoundary:!0,seedPointsCount:0,style:0,patternStyle:1,elevationX:0,elevationY:0,elevationZ:0,extrusionDirectionX:0,extrusionDirectionY:0,extrusionDirectionZ:1,pixelSize:0,layer:"",colorIndex:0,lineType:"",lineTypeScale:1,visible:!0,handle:0,color:0,inPaperSpace:!1,ownerHandle:"",materialObjectHandle:0,lineweight:-3,extendedData:{customStrings:[],applicationName:""}};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 2:t.patternName=a.value;break;case 5:t.handle=a.value;break;case 10:t.elevationX=a.value;break;case 20:t.elevationY=a.value;break;case 30:t.elevationZ=a.value;break;case 41:t.patternScale=a.value;break;case 47:t.pixelSize=a.value;break;case 70:t.solidFill=1===a.value;break;case 71:t.associativity=1===a.value;break;case 73:t.annotatedBoundary=1===a.value;break;case 75:t.style=a.value;break;case 76:t.patternStyle=a.value;break;case 91:t.boundaryPathsCount=a.value,t.boundaries=[];break;case 93:const n=a.value,r=this.parseHatchVertices(n,e);t.boundaries.push(r),a=e.lastReadGroup;break;case 98:t.seedPointsCount=a.value;break;case 210:t.extrusionDirectionX=a.value;break;case 220:t.extrusionDirectionY=a.value;break;case 230:t.extrusionDirectionZ=a.value;break;case 1e3:t.extendedData.applicationName=a.value;break;case 1001:t.extendedData.customStrings.push(a.value);break;default:c(t,a,e)}a=e.next()}return t}parseHatchVertices(e,a){if(!e||e<=0)throw new Error("n must be greater than 0 vertices");const t=[];let n=!1,r=!1,o=a.next();for(let s=0;s<e;s++){const e={x:0,y:0};for(;!a.isEOF()&&0!==o.code&&!r;){switch(o.code){case 10:if(n){r=!0;continue}e.x=o.value,n=!0;break;case 20:e.y=o.value;break;case 42:0!==o.value&&(e.bulge=o.value);break;default:return n&&t.push(e),a.rewind(),t}o=a.next()}t.push(e),n=!1,r=!1}return a.rewind(),t}}class L{ForEntityName="MESH";parseEntity(e,a){const t={type:a.value,vertices:[],faces:[],edges:[],vertexCount:0,faceCount:0,edgeCount:0,subdivisionLevel:0,layer:"",colorIndex:0,lineType:"",lineTypeScale:1,visible:!0,handle:0,color:0,inPaperSpace:!1,ownerHandle:"",materialObjectHandle:0,lineweight:-3,extendedData:{customStrings:[],applicationName:""},extendedDataCodes:[]};for(a=e.next();!e.isEOF()&&0!==a.code;){switch(a.code){case 5:t.handle=a.value;break;case 71:t.subdivisionLevel=a.value;break;case 91:t.vertexCount=a.value;break;case 92:t.faceCount=a.value;break;case 93:t.edgeCount=a.value;const n=[];for(a=e.next();!e.isEOF()&&0!==a.code&&94!==a.code&&1001!==a.code;)95===a.code&&n.push(a.value),a=e.next();n.length>0&&t.edges.push(n),e.rewind();break;case 10:const r={x:a.value,y:0,z:0};if(20!==(a=e.next()).code)throw new Error(`Expected code 20 for vertex y-coordinate, got ${a.code}`);r.y=a.value,30===(a=e.next()).code?(r.z=a.value,a=e.next()):e.rewind(),t.vertices.push(r),0===t.vertexCount&&(t.vertexCount=t.vertices.length);break;case 94:const o=a.value;if(o>4){for(a=e.next();!e.isEOF()&&0!==a.code&&94!==a.code&&93!==a.code&&1001!==a.code;)a=e.next();e.rewind();break}const s=[];let l=0;for(;l<o&&!e.isEOF();)if(95===(a=e.next()).code)s.push(a.value),l++;else if(0===a.code||94===a.code||93===a.code||1001===a.code){e.rewind();break}s.length>0&&t.faces.push(s);break;case 1001:for(t.extendedData.applicationName=a.value,a=e.next();1e3===a.code&&!e.isEOF();)t.extendedData.customStrings.push(a.value),a=e.next();e.rewind();break;default:c(t,a,e)}a=e.next()}return t}}var O=t(65);O.setLevel("error");class C{_entityHandlers={};constructor(){var e;(e=this).registerEntityHandler(l),e.registerEntityHandler(u),e.registerEntityHandler(d),e.registerEntityHandler(b),e.registerEntityHandler(v),e.registerEntityHandler(k),e.registerEntityHandler(x),e.registerEntityHandler(p),e.registerEntityHandler(f),e.registerEntityHandler(h),e.registerEntityHandler(g),e.registerEntityHandler(E),e.registerEntityHandler(m),e.registerEntityHandler(F),e.registerEntityHandler(S),e.registerEntityHandler(T),e.registerEntityHandler(P),e.registerEntityHandler(L)}parse(e){return"string"==typeof e?this._parse(e):(console.error("Cannot read dxf source of type `"+typeof e),null)}registerEntityHandler(e){const a=new e;this._entityHandlers[a.ForEntityName]=a}parseSync(e){return this.parse(e)}parseStream(e){let a="";const t=this;return new Promise((n,r)=>{e.on("data",e=>{a+=e}),e.on("end",()=>{try{n(t._parse(a))}catch(e){r(e)}}),e.on("error",e=>{r(e)})})}_parse(a){const t={};let n=0;const r=a.split(/\r\n|\r|\n/g),o=new e(r);if(!o.hasNext())throw Error("Empty file");const s=this;let c;function l(){let e=null,a=null;const t={};for(c=o.next();;){if(N(c,0,"ENDSEC")){e&&(t[e]=a);break}9===c.code?(e&&(t[e]=a),e=c.value):10===c.code?a={x:c.value}:20===c.code?a.y=c.value:30===c.code?a.z=c.value:a=c.value,c=o.next()}return c=o.next(),t}function i(){const e={};for(c=o.next();"EOF"!==c.value&&!N(c,0,"ENDSEC");)if(N(c,0,"BLOCK")){O.debug("block {");const a=u();O.debug("}"),f(a),a.name?e[a.name]=a:O.error('block with handle "'+a.handle+'" is missing a name.')}else A(c),c=o.next();return e}function u(){const e={};for(c=o.next();"EOF"!==c.value;){switch(c.code){case 1:e.xrefPath=c.value,c=o.next();break;case 2:e.name=c.value,c=o.next();break;case 3:e.name2=c.value,c=o.next();break;case 5:e.handle=c.value,c=o.next();break;case 8:e.layer=c.value,c=o.next();break;case 10:e.position=p(c),c=o.next();break;case 67:e.paperSpace=!(!c.value||1!=c.value),c=o.next();break;case 70:0!=c.value&&(e.type=c.value),c=o.next();break;case 100:c=o.next();break;case 330:e.ownerHandle=c.value,c=o.next();break;case 0:if("ENDBLK"==c.value)break;e.entities=x(!0);break;default:A(c),c=o.next()}if(N(c,0,"ENDBLK")){c=o.next();break}}return e}function d(){const e={};for(c=o.next();"EOF"!==c.value&&!N(c,0,"ENDSEC");)N(c,0,"TABLE")?(c=o.next(),k[c.value]?(O.debug(c.value+" Table {"),e[k[c.value].tableName]=v(c),O.debug("}")):O.debug("Unhandled Table "+c.value)):c=o.next();return c=o.next(),e}const b="ENDTAB";function v(e){const a=k[e.value],t={};let n=0;for(c=o.next();!N(c,0,b);)switch(c.code){case 5:t.handle=c.value,c=o.next();break;case 330:t.ownerHandle=c.value,c=o.next();break;case 100:"AcDbSymbolTable"===c.value||A(c),c=o.next();break;case 70:n=c.value,c=o.next();break;case 0:c.value===a.dxfSymbolName?t[a.tableRecordsProperty]=a.parseTableRecords():(A(c),c=o.next());break;default:A(c),c=o.next()}const r=t[a.tableRecordsProperty];if(r){let e=r.constructor===Array?r.length:"object"==typeof r?Object.keys(r).length:void 0;n!==e&&O.warn("Parsed "+e+" "+a.dxfSymbolName+"'s but expected "+n)}return c=o.next(),t}const k={VPORT:{tableRecordsProperty:"viewPorts",tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:function(){const e=[];let a={};for(O.debug("ViewPort {"),c=o.next();!N(c,0,b);)switch(c.code){case 2:a.name=c.value,c=o.next();break;case 10:a.lowerLeftCorner=p(c),c=o.next();break;case 11:a.upperRightCorner=p(c),c=o.next();break;case 12:a.center=p(c),c=o.next();break;case 13:a.snapBasePoint=p(c),c=o.next();break;case 14:a.snapSpacing=p(c),c=o.next();break;case 15:a.gridSpacing=p(c),c=o.next();break;case 16:a.viewDirectionFromTarget=p(c),c=o.next();break;case 17:a.viewTarget=p(c),c=o.next();break;case 42:a.lensLength=c.value,c=o.next();break;case 43:a.frontClippingPlane=c.value,c=o.next();break;case 44:a.backClippingPlane=c.value,c=o.next();break;case 45:a.viewHeight=c.value,c=o.next();break;case 50:a.snapRotationAngle=c.value,c=o.next();break;case 51:a.viewTwistAngle=c.value,c=o.next();break;case 79:a.orthographicType=c.value,c=o.next();break;case 110:a.ucsOrigin=p(c),c=o.next();break;case 111:a.ucsXAxis=p(c),c=o.next();break;case 112:a.ucsYAxis=p(c),c=o.next();break;case 281:a.renderMode=c.value,c=o.next();break;case 282:a.defaultLightingType=c.value,c=o.next();break;case 292:a.defaultLightingOn=c.value,c=o.next();break;case 330:a.ownerHandle=c.value,c=o.next();break;case 63:case 421:case 431:a.ambientColor=c.value,c=o.next();break;case 0:"VPORT"===c.value&&(O.debug("}"),e.push(a),O.debug("ViewPort {"),a={},c=o.next());break;default:A(c),c=o.next()}return O.debug("}"),e.push(a),e}},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:function(){const e={};let a,t={},n=0;for(O.debug("LType {"),c=o.next();!N(c,0,"ENDTAB");)switch(c.code){case 2:t.name=c.value,a=c.value,c=o.next();break;case 3:t.description=c.value,c=o.next();break;case 73:n=c.value,n>0&&(t.pattern=[]),c=o.next();break;case 40:t.patternLength=c.value,c=o.next();break;case 49:t.pattern.push(c.value),c=o.next();break;case 0:O.debug("}"),n>0&&n!==t.pattern.length&&O.warn("lengths do not match on LTYPE pattern"),e[a]=t,t={},O.debug("LType {"),c=o.next();break;default:c=o.next()}return O.debug("}"),e[a]=t,e}},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:function(){const e={};let a,t={};for(O.debug("Layer {"),c=o.next();!N(c,0,"ENDTAB");)switch(c.code){case 2:t.name=c.value,a=c.value,c=o.next();break;case 62:t.visible=c.value>=0,t.colorIndex=Math.abs(c.value),t.color=H(t.colorIndex),c=o.next();break;case 70:t.frozen=!!(1&c.value)||!!(2&c.value),c=o.next();break;case 420:t.color=Math.abs(c.value),c=o.next();break;case 0:"LAYER"===c.value&&(O.debug("}"),e[a]=t,O.debug("Layer {"),t={},a=void 0,c=o.next());break;default:A(c),c=o.next()}return O.debug("}"),e[a]=t,e}}};function x(e){const a=[],t=e?"ENDBLK":"ENDSEC";for(e||(c=o.next());;)if(0===c.code){if(c.value===t)break;const e=s._entityHandlers[c.value];if(null==e){O.warn("Unhandled entity "+c.value),c=o.next();continue}{O.debug(c.value+" {");const t=e.parseEntity(o,c);c=o.lastReadGroup,O.debug("}"),f(t),a.push(t)}}else c=o.next();return"ENDSEC"==t&&(c=o.next()),a}function p(e){const a={};let t=e.code;if(a.x=e.value,t+=10,(e=o.next()).code!=t)throw new Error("Expected code for point value to be "+t+" but got "+e.code+".");return a.y=e.value,t+=10,(e=o.next()).code!=t?(o.rewind(),a):(a.z=e.value,a)}function f(e){if(!e)throw new TypeError("entity cannot be undefined or null");e.handle||(e.handle=n++)}return function(){for(c=o.next();!o.isEOF();)if(0===c.code&&"SECTION"===c.value){if(c=o.next(),2!==c.code){console.error("Unexpected code %s after 0:SECTION",I(c)),c=o.next();continue}"HEADER"===c.value?(O.debug("> HEADER"),t.header=l(),O.debug("<")):"BLOCKS"===c.value?(O.debug("> BLOCKS"),t.blocks=i(),O.debug("<")):"ENTITIES"===c.value?(O.debug("> ENTITIES"),t.entities=x(!1),O.debug("<")):"TABLES"===c.value?(O.debug("> TABLES"),t.tables=d(),O.debug("<")):"EOF"===c.value?O.debug("EOF"):O.warn("Skipping section '%s'",c.value)}else c=o.next()}(),t}}function N(e,a,t){return e.code===a&&e.value===t}function A(e){O.debug("unhandled group "+I(e))}function I(e){return e.code+":"+e.value}function H(e){return r[e]}})(),n.DxfParser})());